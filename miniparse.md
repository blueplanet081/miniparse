# miniparse -- 簡易コマンドラインパーサ（もう少し詳しい説明）

## オプション情報の定義


```py
import miniparse as mp

pm2: mp.TypeOpList = [('', False, 'ファイル名'),
                      ('l', False, '', '詳細情報も表示する'),
                      ('h', False, '', '使い方を表示する'),
                      ('help', False, '', '使い方を表示する'),
                      ]
opp = mp.OpSet(pm2)

```

  - １つのオプションにつき、ひとつの tuple　(str, bool, str, str)　のリストで定義する。
  - ひとつの tuple内の定義内容は以下のとおり</br>
  

      型      | 定義内容                                   | 省略時
      --------|-------------------------------------------|-------
      str     | オプション文字、または文字列                |
      bool    | そのオプションが引数をとるか（必須か）どうか | False（必須でない）
      str     | オプション引数の説明                       | 空文字列
      str     | オプションの説明                           | 空文字列
</br>

  - オプション引数の説明、オプションの説明は、自動生成する Usage:、またはオプションリストに使われる。この機能を使わない場合は、定義の必要は無い
  - オプション文字、または文字列の項が空文字列の場合は、「コマンド引数」の定義に使われる。
  その次の項目が Trueのとき、コマンドラインに「コマンド引数」の指定が無い場合はエラーになる。
  - 「コマンド引数」の定義の「オプション引数の説明」の項は、Usage:を自動生成する場合に、コマンド引数の説明として使われる。「オプションの説明」は無視される。</br>
  注）コマンド引数が省略可で、Usage: の自動生成での説明等が不要な場合、コマンド引数の定義そのものを省略できる。

</br>

### オプション情報定義と、生成された Usage: の例

  - オプション情報定義の例</br>
  コマンド引数が省略可、オプション -L がオプション引数をとる（必須）

```py
pm2: mp.TypeOpList = [('', False, '[開始ディレクトリ]'),
                      ('a', False, '', 'ドットやシステムディレクトリも表示'),
                      ('L', True, '階層数', '表示するディレクトリの深さを指定する'),
                      ('d', False, '', 'ディレクトリのみ表示'),
                      ('e', False, '', 'ツリーの表示に拡張文字を使用'),
                      ('h', False, '', '使い方を表示する'),
                      ('help', False, '', '使い方を表示する'),
                      ]
opp = mp.OpSet(pm2)
```

  - 自動生成された Usage: とオプションリスト出力例
```
usage: ptree.py  -adeh -L階層数 --help    [開始ディレクトリ]
  -a: ドットやシステムディレクトリも表示
  -L 階層数:  表示するディレクトリの深さを指定する
  -d: ディレクトリのみ表示
  -e: ツリーの表示に拡張文字を使用
  -h: 使い方を表示する
  --help: 使い方を表示する
```
</br>
</br>

### コマンドライン解析後の結果の取得方法
クラス OpSet のメソッドで取得

  - get_keys()  </br>
 　　オプション情報として定義された、オプション文字、文字列の一覧を返す。
  - isExist(op) </br>
 　　そのオプション文字、または文字列がオプション情報中に定義されているかどうか。
  - isTrue(op) </br>
   　　コマンドラインでそのオプション文字、または文字列（op）が指定されたら True。
  - isNeedArg(op) </br>
 　　そのオプションの引数が必須かどうか。
  - get_opArg(op) </br>
 　　コマンドラインで指定された、そのオプションの引数のリストを返す。</br>
 　　（繰り返し指定されると複数のオプション引数が存在するため、リストになっている）</br>
  - get_Argcomment(op) </br>
 　　オプション情報として定義された、そのオプションの引数の説明を取得する。
  - get_comment(op) </br>
 　　オプション情報として定義された、そのオプションの説明を取得する。
</br>
</br>

関数で取得

  - get_arguments() </br>
  　　コマンドラインで指定された、コマンド引数のリストを返す。
</br>
</br>

### その他の関数

  - printUsage(コマンド名、OpSetのインスタンス、Umode)　</br>
  　　簡単な Usage:を出力する。
    - コマンド名（省略時は、デフォルトのコマンド名）
    - Umode
      - Umode.USAGE　　Usage行のみ出力する
      - Umode.OLIST　　オプションリストを出力する
      - Umode.BOTH　 　Usage: とオプションリストの両方を出力する
</br>
</br>
</br>

## エラー検出時の処理

### miniparseは、コマンドライン解析時に次のエラーを検出します。
- コマンド引数が必須の時、コマンド引数が入力されなかった</br>
　　エラーコード 'E0': "Command argument expected"
- 定義以外のオプションが入力された</br>
　　エラーコード 'E1': "Unknown option {0}"  （{0} にオプションが入る）
- オプション引数が必須のオプションが入力されたが、オプション引数が入力されなかった</br>
　　エラーコード 'E2': "Argument expected for the {0} option"  （{0} にオプションが入る）
</br>
</br>

### 上記エラーメッセージは、あらかじめユーザプログラム側で上書きすることができます。
使用例
```py
  import sys
  import miniparse2 as mp

  mp.Eset['E0'] = "コマンドラインで、出力を開始するディレクトリを指定してください"
  mp.Eset['E1'] = "そんなオプション（ {0} ）はありません"

  pm2: mp.TypeOpList = [('', True, 'ディレクトリ名'),
                        ('l', False, '', '詳細情報も表示する'),
                        ('h', False, '', '使い方を表示する'),
                        ('help', False, '', '使い方を表示する'),
                        ]
  opp = mp.OpSet(pm2)
  mp.miniparse(opp, sys.argv)

```


### エラー検出時の処理は、次の３通りになります。
- エラーメッセージを出力して処理終了（デフォルト）</br>
　　error_mode = Emode.ERROR_END　　　# 初期値
- エラーメッセージを出力して処理続行（ユーザプログラム側で終了処理を行う）</br>
　　error_mode = Emode.ERROR_CONT
- エラーメッセージを出力せずに処理続行（エラーメッセージ出力もユーザプログラム側で行う）</br>
　　error_mode = Emode.SILENT_CONT
</br>
</br>
</br>

エラー検出時の処理をユーザプログラム側で実行する例
```py
  mp.error_mode = mp.Emode.SILENT_CONT

  opp = mp.OpSet(pm2)
  mp.miniparse(opp, sys.argv)

  err = mp.get_parseError()
  if err:
      print('入力エラーです。')
      print(mp.make_errmsg(err))
      sys.exit(1)

```

実行例
```py
入力エラーです。
コマンドラインで、出力を開始するディレクトリを指定してください
```

### エラー処理に使用する関数

- get_parseError()</br>
  コマンドライン解析時のエラーを tuple型で取得する。エラーが無い時は空の tupleを返す。</br>
  tuple型のエラーの形式は、以下のとおり</br>
  　　　　(str:エラーコード, str:エラーの原因)　　ex) ('E1', '-L')

- make_errmsg(err)</br>
  定義済みのエラーメッセージ（原文）を元に、エラーメッセージ文字列を生成して返す。</br>
  　　err:　　get_parseError() で得られる tuple型のエラー</br>
  　　ex)　make_errmsg(('E1', '-L'))　で、文字列　"Unknown option -L" を返す